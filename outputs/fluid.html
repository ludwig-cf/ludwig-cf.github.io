<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.2. Fluid Output &#8212; Ludwig 0.24.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=92945a19" />
    <script src="../_static/documentation_options.js?v=a9084e48"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.3. Colloid Output" href="colloid.html" />
    <link rel="prev" title="4.1. Diagnostic Output" href="diagnostic.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="fluid-output">
<h1><span class="section-number">4.2. </span>Fluid Output<a class="headerlink" href="#fluid-output" title="Link to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Many fluid quantities defined at the level of the lattice are available
for output. The fluid quantities include the lattice Boltzmann distributions,
density and velocity, and order parameters if relevant. Output for some
quantities is optional, while output for quantities required for restart
will always be enabled automatically.</p>
<p>All files will appear in the current working directory. Files to be read
are expected to exist in the current working directory at run time.
Note that existing output files may be “clobbered” (overwritten) by new
files of the same name if the code is run twice in the same location
with the same input options.</p>
<section id="i-o-for-all-lattice-quantities">
<h2><span class="section-number">4.2.1. </span>I/O for all lattice quantities<a class="headerlink" href="#i-o-for-all-lattice-quantities" title="Link to this heading">¶</a></h2>
<p>There are a significant number of options related to the input and
output of data. These concern the format of the data, the mechanism
by which the data are produced, and reporting of input/output activity.
The recommended options are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>default_io_mode           mpiio    # Use MPI-IO
default_io_format         binary   # ascii or binary
default_io_report         no       # produce a report on i/o
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">mode</span></code> is the mechanism used to generate the output. The
recommended mode is MPI-IO, which will always work and produce the
same file irrespective of the number of MPI tasks.
The <code class="docutils literal notranslate"><span class="pre">format</span></code> refers to the representation of data in files: either
binary or ASCII is available. Binary format is recommended for reasons
of speed and file size; for these reasons it is also the default. The
report gives details on the performance of the output at each episode.</p>
<section id="control-for-specific-lattice-quantities">
<h3><span class="section-number">4.2.1.1. </span>Control for specific lattice quantities<a class="headerlink" href="#control-for-specific-lattice-quantities" title="Link to this heading">¶</a></h3>
<p>Input and output for different quantities are controlled by specific
key value pairs. For example, options for the density field <code class="docutils literal notranslate"><span class="pre">rho</span></code>
may be selected explicitly - overriding any default - using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>rho_io_mode               mpiio    # overrides default_io_mode
rho_io_format             binary   # overrides default_io_format
rho_io_report             yes      # overrides default_io_report

rho_input_io_format       ascii    # overrides rho_io_mode
rho_output_io_format      binary   # overrides default
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">rho</span></code> has replaced <code class="docutils literal notranslate"><span class="pre">default</span></code> in each case. Available lattice
quantities include (using mode as an example):</p>
</section>
<section id="available-fluid-quantities-for-output">
<h3><span class="section-number">4.2.1.2. </span>Available fluid quantities for output<a class="headerlink" href="#available-fluid-quantities-for-output" title="Link to this heading">¶</a></h3>
<p>The following lattice-based quantities are relevant.</p>
<section id="fluid-distribution-output">
<h4><span class="section-number">4.2.1.2.1. </span>Fluid distribution output<a class="headerlink" href="#fluid-distribution-output" title="Link to this heading">¶</a></h4>
<p>The lattice Boltzmann distributions respond to the keys:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dist_io_mode              mpiio    # overrides default_io_mode
dist_io_format            binary   # overrides default_io_format
dist_io_report            yes      # overrides default_io_report
</pre></div>
</div>
<p>The resulting file names begin with <code class="docutils literal notranslate"><span class="pre">dist</span></code>, and their size is
proportional to the number of distributions in the lattice Boltzmann
model.</p>
</section>
<section id="fluid-density-output">
<h4><span class="section-number">4.2.1.2.2. </span>Fluid density output<a class="headerlink" href="#fluid-density-output" title="Link to this heading">¶</a></h4>
<p>For the fluid density, the keys are as above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>rho_io_mode               mpiio    # overrides default_io_mode
rho_io_format             binary   # overrides default_io_format
rho_io_report             yes      # overrides default_io_report
</pre></div>
</div>
<p>The density is scalar field with file names starting in <code class="docutils literal notranslate"><span class="pre">rho-</span></code>.</p>
</section>
<section id="fluid-velocity-output">
<h4><span class="section-number">4.2.1.2.3. </span>Fluid velocity output<a class="headerlink" href="#fluid-velocity-output" title="Link to this heading">¶</a></h4>
<p>The hydrodynamic velcoity field is available via:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>vel_io_mode               mpiio    # overrides default_io_mode
vel_io_format             binary   # overrides default_io_format
vel_io_report             yes      # overrides default_io_report
</pre></div>
</div>
<p>This is a vector <span class="math notranslate nohighlight">\((u_x, u_y, u_z)\)</span> at each lattice site and
files are prefixed  <code class="docutils literal notranslate"><span class="pre">vel-</span></code>.</p>
</section>
<section id="scalar-order-parameter-output">
<h4><span class="section-number">4.2.1.2.4. </span>Scalar order parameter output<a class="headerlink" href="#scalar-order-parameter-output" title="Link to this heading">¶</a></h4>
<p>For free energies where there is a composition variable <span class="math notranslate nohighlight">\(\phi\)</span> use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>phi_io_mode               mpiio    # overrides default_io_mode
phi_io_format             binary   # overrides default_io_format
phi_io_report             yes      # overrides default_io_report
</pre></div>
</div>
<p>Corresponding files srat with <code class="docutils literal notranslate"><span class="pre">phi-</span></code>.</p>
</section>
<section id="tensor-order-parameter-output">
<h4><span class="section-number">4.2.1.2.5. </span>Tensor order parameter output<a class="headerlink" href="#tensor-order-parameter-output" title="Link to this heading">¶</a></h4>
<p>For liquid crystal problems use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>q_io_mode                 mpiio    # overrides default_io_mode
q_io_format               binary   # overrides default_io_format
q_io_report               yes      # overrides default_io_report
</pre></div>
</div>
<p>Corresponding files start with <code class="docutils literal notranslate"><span class="pre">q-</span></code>.</p>
</section>
<section id="electrokinetic-quantity-output">
<h4><span class="section-number">4.2.1.2.6. </span>Electrokinetic quantity output<a class="headerlink" href="#electrokinetic-quantity-output" title="Link to this heading">¶</a></h4>
<p>Electrokinetic quantities are controlled by the single key</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>psi_io_mode               mpiio    # overrides default_io_mode
psi_io_format             binary   # overrides default_io_format
psi_io_report             yes      # overrides default_io_report
</pre></div>
</div>
<p>Two sets of files will be produced. The first is a scalar field which
is the electric potential with files named <code class="docutils literal notranslate"><span class="pre">psi-</span></code>. The second is a
vector of charge densities (always positive) with files name <code class="docutils literal notranslate"><span class="pre">qsi-</span></code>
(the name <code class="docutils literal notranslate"><span class="pre">rho</span></code> being reserved for the fluid density).</p>
</section>
</section>
<section id="frequency-of-i-o">
<h3><span class="section-number">4.2.1.3. </span>Frequency of I/O<a class="headerlink" href="#frequency-of-i-o" title="Link to this heading">¶</a></h3>
<p>The frequency of output for particular quantities can be controlled by,
e.g., for fluid density</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>rho_io_freq    100     # Output every 100 time steps
</pre></div>
</div>
<p>If this key does not appear, no output will occur (other than required
for full confiuration/restart; see below). The frequency must not be
negative; if the frequency is set to zero, this is interpreted as
“never”. Frequency is not relevant for input.</p>
<p>Note there is no default frequency. Frequecies for different lattice
quantities should be set with the appropriate name, e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>phi_io_freq    100     # Compositional order parameter
psi_io_freq    100     # Electrokinetic quantities
</pre></div>
</div>
</section>
<section id="configuration-output">
<h3><span class="section-number">4.2.1.4. </span>Configuration output<a class="headerlink" href="#configuration-output" title="Link to this heading">¶</a></h3>
<p>Fields required for configuration output - that required for restart - are
determined internally by the code depending on the details of the
simulation requested. The frequency of this output can be set via</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>freq_config    10000   # Full configuration output for restart
</pre></div>
</div>
<p>Full configuration output includes the lattice Boltzmann distributions,
the density and velocity fields, and order parameters as required. The
density and velocity fields are required in addition to the lattice
Boltzmann distributions to ensure reproducibility at restarts. If
isothermal fluctuations are present, the state of the lattice random
number generator is also saved to file to take part in restart.</p>
<p>If a configuration output step co-incides with a “normal” output step
for a particular quantity, output only occurs once.</p>
<p>If a full configuration is not required at the end of the run, one can
set</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config_at_end          no      # default is &quot;yes&quot;
</pre></div>
</div>
<p>The default is that configuration output should be produced at the end.</p>
</section>
<section id="meta-data-and-data-file-names">
<h3><span class="section-number">4.2.1.5. </span>Meta data and data file names<a class="headerlink" href="#meta-data-and-data-file-names" title="Link to this heading">¶</a></h3>
<p>Requests for file output will always create a relevant <cite>metadata</cite> file
for the type of output requested. For example, a request for order
parameter output will generate a single JSON file</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>phi-metadata.001-001
</pre></div>
</div>
<p>which contains information on the system size, order parameter fields
and so on. The meta-data file provides a description of the corresponding
data and is useful for post-processing.</p>
<p>Actual data appear in a separate file for each time step (at the
frequency requested), e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>phi-000000000.001-001
phi-000020000.001-001
</pre></div>
</div>
<p>would be expected for a simulation starting at time step zero, and
producing output at each 20,000 steps. The file
extension <code class="docutils literal notranslate"><span class="pre">.001-001</span></code> indicates this is one file in a set of one.</p>
</section>
<section id="multiple-file-output">
<h3><span class="section-number">4.2.1.6. </span>Multiple file output<a class="headerlink" href="#multiple-file-output" title="Link to this heading">¶</a></h3>
<p>For the largest systems (probably larger than <span class="math notranslate nohighlight">\(512^3\)</span>) run on very large
numbers of MPI tasks, it may be favourable to ask for output to be
written to more than one file. This allows a larger overall bandwidth
to disk to be obtained. The downside is that the separate files must
be recombined if a complete view is required for visualisation etc.</p>
<p>Output (and input) to more than one file is requested by specifying an
I/O grid. This decomposes the system in a similar way to the processor
decomposition (with one or more MPI tasks per I/O grid group).</p>
<p>The I/O grid is set via</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>default_io_grid 2_2_1
</pre></div>
</div>
<p>which would result is four I/O groups writing to four separate files, e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>phi-000020000.001-004
phi-000020000.002-004
phi-000020000.003-004
phi-000020000.004-004
</pre></div>
</div>
<p>with corresponding metadata files. The metadata files will detail which
portions of the complete system are held by the respective data files.</p>
</section>
</section>
<section id="file-data-formats">
<h2><span class="section-number">4.2.2. </span>File Data Formats<a class="headerlink" href="#file-data-formats" title="Link to this heading">¶</a></h2>
<section id="data-format">
<h3><span class="section-number">4.2.2.1. </span>Data format<a class="headerlink" href="#data-format" title="Link to this heading">¶</a></h3>
<p>Output can be requested in either ASCII or (raw) binary format. While
ASCII output can be appropriate for initial investigations, it is
recommended that binary format is used. The data is always stored as
8-byte floating point in binary format. In ASCII there are usually
15 decimal places of precision.</p>
</section>
<section id="serial-storage-order">
<h3><span class="section-number">4.2.2.2. </span>Serial storage order<a class="headerlink" href="#serial-storage-order" title="Link to this heading">¶</a></h3>
<p>In serial (or with one MPI task with multiple threads), output occurs
to a single file. Data for fluid quantities are written to file on
a per-lattice site basis in the following order:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x_1 y_1 z_1   q_1 q_2 ...
x_1 y_1 z_2   q_1 q_2 ...
...
x_1 y_1 z_N   ...
x_1 y_2 z_1   ...
...
</pre></div>
</div>
<p>Files written in parallel automatically follow this order.</p>
</section>
</section>
<section id="older-style-i-o-mode">
<h2><span class="section-number">4.2.3. </span>Older-style I/O mode<a class="headerlink" href="#older-style-i-o-mode" title="Link to this heading">¶</a></h2>
<p>The “ansi” I/O mechanism was removed at Revision 0.22.0 in favour of
the MPI/IO mechanism as the default. Serial files written with the
old mechanism can be read by the MPI/IO mechanism.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Ludwig</a></h1>








<h2>Contents</h2>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../building/index.html">1. Building and Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inputs/index.html">2. Input File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../initial/index.html">3. Initial Conditions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. Outputs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="diagnostic.html">4.1. Diagnostic Output</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.2. Fluid Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="colloid.html">4.3. Colloid Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">5. Tutorial guides</a></li>
</ul>


<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2021-2026, The University of Edinburgh.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/outputs/fluid.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>